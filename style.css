// ãƒšãƒ¼ã‚¸ç®¡ç†
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });

  const target = document.getElementById(pageId);
  if (target) target.classList.add('active');

  window.scrollTo({ top: 0, behavior: 'smooth' });

  // çµ±è¨ˆè¨˜éŒ²
  trackPageView(pageId);
}

// çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆlocalStorageã«ä¿å­˜ï¼‰
function trackPageView(pageId) {
  const stats = JSON.parse(localStorage.getItem('fortuneStats') || '{}');
  const today = new Date().toISOString().split('T')[0];

  if (!stats[today]) {
    stats[today] = {
      pageViews: {},
      fortunes: 0,
      lineRegistrations: 0,
      payments: 0,
      courseSignups: 0
    };
  }

  stats[today].pageViews[pageId] = (stats[today].pageViews[pageId] || 0) + 1;
  localStorage.setItem('fortuneStats', JSON.stringify(stats));
}

function trackEvent(eventType) {
  const stats = JSON.parse(localStorage.getItem('fortuneStats') || '{}');
  const today = new Date().toISOString().split('T')[0];

  if (!stats[today]) {
    stats[today] = {
      pageViews: {},
      fortunes: 0,
      lineRegistrations: 0,
      payments: 0,
      courseSignups: 0
    };
  }

  stats[today][eventType] = (stats[today][eventType] || 0) + 1;
  localStorage.setItem('fortuneStats', JSON.stringify(stats));
}

// çµ±è¨ˆè¡¨ç¤ºï¼ˆé–‹ç™ºç”¨ - ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªï¼‰
function showStats() {
  const stats = JSON.parse(localStorage.getItem('fortuneStats') || '{}');
  console.log('=== çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ ===');
  console.table(stats);
  return stats;
}

// å¹´æœˆæ—¥ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆ
function initializeDateSelects() {
  const yearSelect = document.getElementById('year');
  const monthSelect = document.getElementById('month');
  const daySelect = document.getElementById('day');

  // ãƒšãƒ¼ã‚¸æ§‹æˆãŒé•ã†å ´åˆã«è½ã¡ãªã„ã‚ˆã†ã«
  if (!yearSelect || !monthSelect || !daySelect) return;

  const currentYear = new Date().getFullYear();

  for (let year = currentYear; year >= 1940; year--) {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = `${year}å¹´`;
    yearSelect.appendChild(option);
  }

  for (let month = 1; month <= 12; month++) {
    const option = document.createElement('option');
    option.value = month;
    option.textContent = `${month}æœˆ`;
    monthSelect.appendChild(option);
  }

  for (let day = 1; day <= 31; day++) {
    const option = document.createElement('option');
    option.value = day;
    option.textContent = `${day}æ—¥`;
    daySelect.appendChild(option);
  }
}

// äº”è¡Œã®åˆ¤å®š
function getElement(year, month, day) {
  const sum = (year + month * 10 + day) % 5;
  const elements = [
    {
      name: 'æœ¨',
      color: '#4CAF50',
      meaning: 'æˆé•·ã®æ°—è³ª',
      description: 'æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã™ã‚‹åŠ›ã‚’æŒã¤ã‚ãªãŸã€‚å‰µé€ æ€§ã¨æŸ”è»Ÿæ€§ãŒç‰¹å¾´ã§ã™ã€‚'
    },
    {
      name: 'ç«',
      color: '#FF5722',
      meaning: 'æƒ…ç†±ã®æ°—è³ª',
      description: 'æƒ…ç†±çš„ã§è¡Œå‹•åŠ›ã®ã‚ã‚‹ã‚ãªãŸã€‚å‘¨ã‚Šã‚’æ˜ã‚‹ãç…§ã‚‰ã™å­˜åœ¨ã§ã™ã€‚'
    },
    {
      name: 'åœŸ',
      color: '#D4AF37',
      meaning: 'å®‰å®šã®æ°—è³ª',
      description: 'å®‰å®šæ„ŸãŒã‚ã‚Šä¿¡é ¼ã•ã‚Œã‚‹å­˜åœ¨ã€‚èª¿å’Œã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚ãªãŸã§ã™ã€‚'
    },
    {
      name: 'é‡‘',
      color: '#FFD700',
      meaning: 'æ´—ç·´ã®æ°—è³ª',
      description: 'ç¾ã—ã„ã‚‚ã®ã‚’æ„›ã—ã€å“æ ¼ã®ã‚ã‚‹ã‚ãªãŸã€‚èŠ¸è¡“çš„ã‚»ãƒ³ã‚¹ã«æµã¾ã‚Œã¦ã„ã¾ã™ã€‚'
    },
    {
      name: 'æ°´',
      color: '#2196F3',
      meaning: 'æŸ”è»Ÿã®æ°—è³ª',
      description: 'æŸ”è»Ÿã§é©å¿œåŠ›ãŒé«˜ã„ã‚ãªãŸã€‚ç›´æ„ŸåŠ›ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚'
    }
  ];
  return elements[sum];
}

// é‹å‹¢ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
function generateFortune(year, month, day) {
  const element = getElement(year, month, day);
  const seed = year + month + day;

  const totalLevel = (seed % 5) + 1;
  const loveLevel = ((seed * 2) % 5) + 1;
  const workLevel = ((seed * 3) % 5) + 1;
  const moneyLevel = ((seed * 4) % 5) + 1;
  const healthLevel = ((seed * 5) % 5) + 1;

  const fortunes = {
    total: {
      level: totalLevel,
      messages: [
        'ä»Šã¯æº–å‚™ã®æ™‚æœŸã§ã™ã€‚ç„¦ã‚‰ãšã€ã˜ã£ãã‚Šã¨åŠ›ã‚’è“„ãˆã‚‹ã“ã¨ã§ã€å¤§ããªé£›èºã®ãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚è‡ªåˆ†ç£¨ãã«æ™‚é–“ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚',
        'é‹æ°—ã¯ä¸Šæ˜‡å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚æ–°ã—ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã«æœ€é©ãªæ™‚æœŸã§ã™ã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ã§ã€ç´ æ™´ã‚‰ã—ã„çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚',
        'å®‰å®šã—ãŸé‹æ°—ãŒç¶šã„ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¾ã§ã®åŠªåŠ›ãŒå®Ÿã‚’çµã³å§‹ã‚ã‚‹å…†ã—ãŒè¦‹ãˆã¦ã„ã¾ã™ã€‚å‘¨å›²ã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚',
        'çµ¶å¥½èª¿ã®é‹æ°—ã«æµã¾ã‚Œã¦ã„ã¾ã™ï¼ã‚ãªãŸã®é­…åŠ›ãŒæœ€å¤§é™ã«è¼ãæ™‚æœŸã§ã™ã€‚ç©æ¥µçš„ã«è¡Œå‹•ã™ã‚‹ã“ã¨ã§ã€æƒ³åƒä»¥ä¸Šã®æˆæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚',
        'æœ€é«˜æ½®ã®é‹æ°—ã§ã™ã€‚é¡˜ã„ãŒæ¬¡ã€…ã¨å¶ã†å¥‡è·¡çš„ãªæ™‚æœŸã‚’è¿ãˆã¦ã„ã¾ã™ã€‚æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¿˜ã‚Œãšã«ã€ãã®å¹¸é‹ã‚’å‘¨ã‚Šã«ã‚‚åˆ†ã‘ä¸ãˆã¾ã—ã‚‡ã†ã€‚'
      ]
    },
    love: {
      level: loveLevel,
      descriptions: [
        'ç„¦ã‚‰ãšè‡ªåˆ†ç£¨ãã®æ™‚æœŸã€‚å†…é¢ã‚’ç£¨ãã“ã¨ã§ã€å°†æ¥ã®ç´ æ•µãªå‡ºä¼šã„ã«ã¤ãªãŒã‚Šã¾ã™ã€‚',
        'ãƒãƒ£ãƒ³ã‚¹åˆ°æ¥ã®äºˆæ„Ÿã€‚ã‚¢ãƒ³ãƒ†ãƒŠã‚’é«˜ãå¼µã£ã¦ã€å‡ºä¼šã„ã®æ©Ÿä¼šã‚’é€ƒã•ãªã„ã§ã€‚',
        'è‰¯ã„å‡ºä¼šã„ã«æµã¾ã‚Œã‚‹æ™‚æœŸã€‚è‡ªç„¶ä½“ã§æ¥ã™ã‚‹ã“ã¨ã§ã€é‹å‘½ã®äººã¨ã®è·é›¢ãŒç¸®ã¾ã‚Šã¾ã™ã€‚',
        'æƒ…ç†±çš„ãªæ‹ã®å§‹ã¾ã‚Šã€‚ç©æ¥µçš„ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã™ã‚‹ã“ã¨ã§ã€ç´ æ™´ã‚‰ã—ã„é–¢ä¿‚ãŒç¯‰ã‘ã¾ã™ã€‚',
        'é‹å‘½ã®äººã¨å‡ºä¼šãˆã‚‹æœ€é«˜ã®æ™‚æœŸã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ã§ã€ç†æƒ³ã®æ‹æ„›ãŒå®Ÿç¾ã—ã¾ã™ã€‚'
      ]
    },
    work: {
      level: workLevel,
      descriptions: [
        'æº–å‚™æœŸé–“ã¨ã—ã¦æœ‰æ„ç¾©ã«ã€‚ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã«æ™‚é–“ã‚’ä½¿ã†ã“ã¨ã§ã€å°†æ¥ã®é£›èºã«ã¤ãªãŒã‚Šã¾ã™ã€‚',
        'å¾ã€…ã«æˆæœãŒç¾ã‚Œå§‹ã‚ã‚‹æ™‚æœŸã€‚è«¦ã‚ãšã«ç¶šã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚',
        'åŠªåŠ›ãŒèªã‚ã‚‰ã‚Œã‚‹æ™‚æœŸã€‚è‡ªä¿¡ã‚’æŒã£ã¦è‡ªåˆ†ã®æ„è¦‹ã‚’ä¼ãˆã¾ã—ã‚‡ã†ã€‚',
        'å¤§ããªãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚æ€ã„åˆ‡ã£ãŸæ±ºæ–­ãŒæˆåŠŸã¸ã®éµã¨ãªã‚Šã¾ã™ã€‚',
        'ã‚­ãƒ£ãƒªã‚¢ã®å¤§é£›èºã®æ™‚ã€‚æ˜‡é€²ã‚„è»¢è·ãªã©ã€äººç”Ÿã‚’å¤‰ãˆã‚‹å‡ºæ¥äº‹ãŒå¾…ã£ã¦ã„ã¾ã™ã€‚'
      ]
    },
    money: {
      level: moneyLevel,
      descriptions: [
        'å …å®Ÿãªè²¯è“„ã‚’å¿ƒãŒã‘ã¦ã€‚ç„¡é§„é£ã„ã‚’æ§ãˆã€å°†æ¥ã«å‚™ãˆã‚‹æ™‚æœŸã§ã™ã€‚',
        'è‡¨æ™‚åå…¥ã®å¯èƒ½æ€§ã‚ã‚Šã€‚æ€ã‚ã¬ã¨ã“ã‚ã‹ã‚‰åå…¥ãŒå…¥ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚',
        'å®‰å®šã—ãŸé‡‘é‹ã«æµã¾ã‚Œã¾ã™ã€‚è¨ˆç”»çš„ãªè³‡ç”£å½¢æˆã‚’å§‹ã‚ã‚‹ã®ã«è‰¯ã„æ™‚æœŸã§ã™ã€‚',
        'æŠ•è³‡ã®ãƒãƒ£ãƒ³ã‚¹ã€‚ç›´æ„Ÿã¨æƒ…å ±åé›†ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦åˆ¤æ–­ã—ã¾ã—ã‚‡ã†ã€‚',
        'äºˆæƒ³å¤–ã®å¤§ããªåå…¥ãŒæœŸå¾…ã§ãã¾ã™ã€‚ãŸã ã—ã€æ„Ÿè¬ã‚’å¿˜ã‚Œãšè³¢ãä½¿ã„ã¾ã—ã‚‡ã†ã€‚'
      ]
    },
    health: {
      level: healthLevel,
      descriptions: [
        'ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã‚’å¤§åˆ‡ã«ã€‚ååˆ†ãªç¡çœ ã¨æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚',
        'ä½“èª¿ç®¡ç†ã«æ°—ã‚’ã¤ã‘ã¦ã€‚ç„¡ç†ã›ãšã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å®ˆã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚',
        'è‰¯å¥½ãªå¥åº·çŠ¶æ…‹ãŒç¶šãã¾ã™ã€‚æ–°ã—ã„é‹å‹•ç¿’æ…£ã‚’å§‹ã‚ã‚‹ã®ã«æœ€é©ãªæ™‚æœŸã§ã™ã€‚',
        'ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æº€ã¡æº¢ã‚Œã‚‹æ™‚æœŸã€‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«éã”ã™ã“ã¨ã§ã€ã•ã‚‰ã«é‹æ°—ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚',
        'æœ€é«˜ã®å¥åº·é‹ã€‚å¿ƒèº«ã¨ã‚‚ã«çµ¶å¥½èª¿ã€‚ã“ã®å‹¢ã„ã§æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¾ã—ã‚‡ã†ã€‚'
      ]
    }
  };

  const luckyColors = [
    { name: 'ãƒ­ãƒ¼ã‚ºã‚´ãƒ¼ãƒ«ãƒ‰', value: '#B76E79' },
    { name: 'ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³ã‚´ãƒ¼ãƒ«ãƒ‰', value: '#F7E7CE' },
    { name: 'ãƒ‘ãƒ¼ãƒ«ãƒ›ãƒ¯ã‚¤ãƒˆ', value: '#F8F8FF' },
    { name: 'ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼', value: '#E6E6FA' },
    { name: 'ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³', value: '#98D8C8' },
    { name: 'ã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯', value: '#F88379' },
    { name: 'ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼', value: '#87CEEB' }
  ];

  const luckyItems = [
    'ãƒ‘ãƒ¼ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼',
    'ã‚·ãƒ«ã‚¯ã®ã‚¹ã‚«ãƒ¼ãƒ•',
    'ã‚¯ãƒªã‚¹ã‚¿ãƒ«ã®ã‚ªãƒ–ã‚¸ã‚§',
    'ãŠæ°—ã«å…¥ã‚Šã®é¦™æ°´',
    'ã‚´ãƒ¼ãƒ«ãƒ‰ã®ãƒªãƒ³ã‚°',
    'å¤©ç„¶çŸ³ã®ãƒ–ãƒ¬ã‚¹ãƒ¬ãƒƒãƒˆ',
    'ãŠèŠ±ã®ãƒ˜ã‚¢ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼',
    'æ‰‹å¸³ã¨ã‚´ãƒ¼ãƒ«ãƒ‰ãƒšãƒ³',
    'ã‚¢ãƒ­ãƒãƒ‡ã‚£ãƒ•ãƒ¥ãƒ¼ã‚¶ãƒ¼',
    'ã‚·ãƒ«ãƒãƒ¼ã®ãƒãƒƒã‚¯ãƒ¬ã‚¹'
  ];

  const luckyDays = ['æœˆæ›œæ—¥', 'æ°´æ›œæ—¥', 'é‡‘æ›œæ—¥', 'åœŸæ›œæ—¥', 'æ—¥æ›œæ—¥'];

  const luckyColorIndex = seed % luckyColors.length;

  return {
    element,
    total: { level: totalLevel, message: fortunes.total.messages[totalLevel - 1] },
    love: { level: loveLevel, description: fortunes.love.descriptions[loveLevel - 1] },
    work: { level: workLevel, description: fortunes.work.descriptions[workLevel - 1] },
    money: { level: moneyLevel, description: fortunes.money.descriptions[moneyLevel - 1] },
    health: { level: healthLevel, description: fortunes.health.descriptions[healthLevel - 1] },
    lucky: {
      color: luckyColors[luckyColorIndex].name,
      colorValue: luckyColors[luckyColorIndex].value,
      number: (seed % 9) + 1,
      item: luckyItems[seed % luckyItems.length],
      day: luckyDays[seed % luckyDays.length]
    },
    advice: getAdvice(element.name)
  };
}

// æ˜Ÿã‚’ç”Ÿæˆ
function getStars(level) {
  return 'â˜…'.repeat(level) + 'â˜†'.repeat(5 - level);
}

// ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
function getAdvice(elementName) {
  const advices = {
    'æœ¨': 'æˆé•·ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤ã‚ãªãŸã€‚æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹é£›èºãŒæœŸå¾…ã§ãã¾ã™ã€‚è‡ªç„¶ã«è§¦ã‚Œã‚‹æ™‚é–“ã‚’ä½œã‚‹ã¨ã€é‹æ°—ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚',
    'ç«': 'æƒ…ç†±çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æº€ã¡ãŸã‚ãªãŸã€‚ãã®ç†±ã„æƒ³ã„ã‚’å½¢ã«ã™ã‚‹ã“ã¨ã§ã€å‘¨å›²ã‚’æ˜ã‚‹ãç…§ã‚‰ã™ã§ã—ã‚‡ã†ã€‚å‰µé€ çš„ãªæ´»å‹•ãŒé–‹é‹ã®éµã§ã™ã€‚',
    'åœŸ': 'å®‰å®šã¨èª¿å’Œã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤ã‚ãªãŸã€‚å‘¨å›²ã¨ã®çµ†ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã§ã€ç¢ºå®Ÿã«å¹¸é‹ã‚’æ´ã‚ã¾ã™ã€‚æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¿˜ã‚Œãšã«ã€‚',
    'é‡‘': 'æ´—ç·´ã•ã‚ŒãŸã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤ã‚ãªãŸã€‚ç¾ã—ã„ã‚‚ã®ã«è§¦ã‚Œã‚‹ã“ã¨ã§ã€ã•ã‚‰ã«é‹æ°—ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚å“è³ªã®é«˜ã„ã‚‚ã®ã‚’é¸ã¶ã“ã¨ã‚’å¿ƒãŒã‘ã¦ã€‚',
    'æ°´': 'æŸ”è»Ÿãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æµã¾ã‚ŒãŸã‚ãªãŸã€‚æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã§ã€æ€ã‚ã¬ãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚ç›´æ„Ÿã‚’å¤§åˆ‡ã«ã—ã¾ã—ã‚‡ã†ã€‚'
  };
  return advices[elementName];
}

// çµæœã‚’è¡¨ç¤º
function displayResult(fortune, year, month, day) {
  const el = (id) => document.getElementById(id);

  el('elementBadge').textContent = `${fortune.element.name}ã®æ€§è³ª - ${fortune.element.meaning}`;
  el('resultTitle').textContent = fortune.element.description;
  el('birthDate').textContent = `${year}å¹´${month}æœˆ${day}æ—¥ç”Ÿã¾ã‚Œ`;

  el('totalStars').textContent = getStars(fortune.total.level);
  el('totalText').textContent = fortune.total.message;

  el('loveStars').textContent = getStars(fortune.love.level);
  el('loveDesc').textContent = fortune.love.description;

  el('workStars').textContent = getStars(fortune.work.level);
  el('workDesc').textContent = fortune.work.description;

  el('moneyStars').textContent = getStars(fortune.money.level);
  el('moneyDesc').textContent = fortune.money.description;

  el('healthStars').textContent = getStars(fortune.health.level);
  el('healthDesc').textContent = fortune.health.description;

  el('colorDot').style.backgroundColor = fortune.lucky.colorValue;
  el('luckyColor').textContent = fortune.lucky.color;
  el('luckyNumber').textContent = fortune.lucky.number;
  el('luckyItem').textContent = fortune.lucky.item;
  el('luckyDay').textContent = fortune.lucky.day;

  showPage('resultPage');
  trackEvent('fortunes');
}

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
const fortuneForm = document.getElementById('fortuneForm');
if (fortuneForm) {
  fortuneForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const year = parseInt(document.getElementById('year').value);
    const month = parseInt(document.getElementById('month').value);
    const day = parseInt(document.getElementById('day').value);
    const email = document.getElementById('email').value;

    if (!year || !month || !day) {
      alert('ç”Ÿå¹´æœˆæ—¥ã‚’å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    // ãƒ¡ãƒ¼ãƒ«ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if (email) {
      const users = JSON.parse(localStorage.getItem('fortuneUsers') || '[]');
      users.push({
        email,
        birthDate: { year, month, day },
        timestamp: new Date().toISOString()
      });
      localStorage.setItem('fortuneUsers', JSON.stringify(users));
    }

    const fortune = generateFortune(year, month, day);
    displayResult(fortune, year, month, day);
  });
}

// æ±ºæ¸ˆãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
const paymentForm = document.getElementById('paymentForm');
if (paymentForm) {
  paymentForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const name = document.getElementById('customerName').value;
    const email = document.getElementById('customerEmail').value;
    const phone = document.getElementById('customerPhone').value;

    const pm = document.querySelector('input[name="paymentMethod"]:checked');
    const paymentMethod = pm ? pm.value : 'credit';

    if (!name || !email || !phone) {
      alert('å¿…é ˆé …ç›®ã‚’å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    if (paymentMethod === 'credit') {
      const cardNumber = document.getElementById('cardNumber').value;
      const cardExpiry = document.getElementById('cardExpiry').value;
      const cardCvc = document.getElementById('cardCvc').value;
      const cardName = document.getElementById('cardName').value;

      if (!cardNumber || !cardExpiry || !cardCvc || !cardName) {
        alert('ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
    }

    const payments = JSON.parse(localStorage.getItem('fortunePayments') || '[]');
    payments.push({
      name,
      email,
      phone,
      amount: 9800,
      type: 'premium',
      paymentMethod,
      timestamp: new Date().toISOString()
    });
    localStorage.setItem('fortunePayments', JSON.stringify(payments));

    trackEvent('payments');

    alert('âœ¨ ãŠç”³ã—è¾¼ã¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ï¼ˆãƒ‡ãƒ¢ï¼‰\n\nLINEç™»éŒ²ã‚‚ãŠå¿˜ã‚Œãªãï¼');

    showPage('resultPage');
    paymentForm.reset();
  });
}

// è¬›åº§ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
const courseSignupForm = document.getElementById('courseSignupForm');
if (courseSignupForm) {
  courseSignupForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const name = document.getElementById('courseName').value;
    const email = document.getElementById('courseEmail').value;
    const phone = document.getElementById('coursePhone').value;
    const cardNumber = document.getElementById('courseCardNumber').value;
    const cardExpiry = document.getElementById('courseCardExpiry').value;
    const cardCvc = document.getElementById('courseCardCvc').value;

    if (!name || !email || !phone || !cardNumber || !cardExpiry || !cardCvc) {
      alert('å¿…é ˆé …ç›®ã‚’å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    const courseSignups = JSON.parse(localStorage.getItem('fortuneCourseSignups') || '[]');
    courseSignups.push({
      name,
      email,
      phone,
      plan: 'monthly',
      timestamp: new Date().toISOString()
    });
    localStorage.setItem('fortuneCourseSignups', JSON.stringify(courseSignups));

    trackEvent('courseSignups');

    alert('ğŸ“ è¬›åº§ã¸ã®ãŠç”³ã—è¾¼ã¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ï¼ˆãƒ‡ãƒ¢ï¼‰\n\nåˆæœˆç„¡æ–™ã§ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚\n\n2ãƒ¶æœˆç›®ã‹ã‚‰æœˆé¡29,800å††ï¼ˆãƒ‡ãƒ¢ï¼‰\nã„ã¤ã§ã‚‚è§£ç´„å¯èƒ½ï¼ˆæƒ³å®šï¼‰');

    showPage('freebiesPage');
    courseSignupForm.reset();
  });
}

// LINEç™»éŒ²
function registerLine() {
  trackEvent('lineRegistrations');
  const modal = document.getElementById('lineModal');
  if (modal) modal.classList.add('active');
}

function closeLineModal() {
  const modal = document.getElementById('lineModal');
  if (modal) modal.classList.remove('active');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
const lineModal = document.getElementById('lineModal');
if (lineModal) {
  lineModal.addEventListener('click', (e) => {
    if (e.target.id === 'lineModal') closeLineModal();
  });
}

// ç‰¹å…¸è¡¨ç¤º
function viewFreebie(type) {
  if (type === 'guide') {
    showPage('guidePage');
  } else if (type === 'manga') {
    showPage('mangaPage');
  }
}

// ã‚«ãƒ¼ãƒ‰ç•ªå·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
document.getElementById('cardNumber')?.addEventListener('input', (e) => {
  let value = e.target.value.replace(/\s/g, '');
  let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
  e.target.value = formattedValue;
});

document.getElementById('courseCardNumber')?.addEventListener('input', (e) => {
  let value = e.target.value.replace(/\s/g, '');
  let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
  e.target.value = formattedValue;
});

// æœ‰åŠ¹æœŸé™ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
document.getElementById('cardExpiry')?.addEventListener('input', (e) => {
  let value = e.target.value.replace(/\//g, '');
  if (value.length >= 2) {
    e.target.value = value.slice(0, 2) + '/' + value.slice(2, 4);
  } else {
    e.target.value = value;
  }
});

document.getElementById('courseCardExpiry')?.addEventListener('input', (e) => {
  let value = e.target.value.replace(/\//g, '');
  if (value.length >= 2) {
    e.target.value = value.slice(0, 2) + '/' + value.slice(2, 4);
  } else {
    e.target.value = value;
  }
});

// åˆæœŸåŒ–
initializeDateSelects();

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®çµ±è¨ˆè¨˜éŒ²
trackPageView('topPage');

// é–‹ç™ºãƒ­ã‚°
console.log('%cå››æŸ±æ¨å‘½ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é‘‘å®š', 'font-size: 20px; color: #ffd700; font-weight: bold;');
console.log('%cçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ã«ã¯ showStats() ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'color: #d4af37;');
console.log('%cLocalStorageã®ãƒ‡ãƒ¼ã‚¿:', 'color: #4caf50;');
console.log('- fortuneStats: çµ±è¨ˆãƒ‡ãƒ¼ã‚¿');
console.log('- fortuneUsers: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿');
console.log('- fortunePayments: æ±ºæ¸ˆãƒ‡ãƒ¼ã‚¿');
console.log('- fortuneCourseSignups: è¬›åº§ç™»éŒ²ãƒ‡ãƒ¼ã‚¿');

